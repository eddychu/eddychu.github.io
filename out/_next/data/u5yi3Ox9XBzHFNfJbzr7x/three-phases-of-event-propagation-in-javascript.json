{"pageProps":{"post":{"type":"file","path":"index","content":{"attributes":{"title":"Three phases of event propagation in javascript","date":"Mon Nov 02 2020 16:50:36 GMT+0800 (China Standard Time)"},"body":"<p>Javascript programs use an asynchronous event-driven programming model. When something happens on the webpage, the browser will generate a event for it, a special function called event handler then gets called. If there are more than one event handler binded, they will be exectued in the same order as they were added.</p>\n<p>To understand how events are handled in javascript (client side), we have to understand the three phase of event propagation.</p>\n<h2 id=\"first-capturing-phase\">First: Capturing phase</h2>\n<p>Before a event on a target object is invoked, the event is in the so called capturing phase. Recall that addEventListener() takes an optional third argument. If that argument is true ,or {capture:true}, then the event handler is registered as a capturing event handler\nfor invocation during this first phase of event propagation.</p>\n<p>During this phase, the capturing handlers of the Window object are invoked first, then the capturing handler of the Document object, then of the body object, and so on down the DOM tree until the capturing event handlers of the parent of the event target. </p>\n<pre><code class=\"language-html\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;box&quot;</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;button&quot;</span>&gt;</span>Button<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;other&quot;</span>&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"javascript\">\n        <span class=\"hljs-keyword\">const</span> button = <span class=\"hljs-built_in\">document</span>.getElementById(<span class=\"hljs-string\">&quot;button&quot;</span>);\n        <span class=\"hljs-keyword\">const</span> box = <span class=\"hljs-built_in\">document</span>.getElementById(<span class=\"hljs-string\">&quot;box&quot;</span>);\n        <span class=\"hljs-keyword\">const</span> other = <span class=\"hljs-built_in\">document</span>.getElementById(<span class=\"hljs-string\">&quot;other&quot;</span>);\n        button.addEventListener(<span class=\"hljs-string\">&quot;click&quot;</span>, <span class=\"hljs-function\">() =&gt;</span> {\n            <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">&quot;hello from button&quot;</span>);\n        })\n        box.addEventListener(<span class=\"hljs-string\">&quot;click&quot;</span>, <span class=\"hljs-function\">() =&gt;</span> {\n            <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">&quot;hello from box&quot;</span>);\n        })\n        box.addEventListener(<span class=\"hljs-string\">&quot;click&quot;</span>, <span class=\"hljs-function\">(<span class=\"hljs-params\">e</span>) =&gt;</span> {\n            <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">&quot;hello from box, capture&quot;</span>);\n        }, {<span class=\"hljs-attr\">capture</span>: <span class=\"hljs-literal\">true</span>})\n\n    </span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n</code></pre>\n<p>because the capturing phase happens before the target event handler gets called, the last capture event handler will be called first. and then the button object&#39;s event handler gets called before it bubbles up to the parent object again.</p>\n<p>if we add event.stopPropagation() in the capture event handler, then the button click event will be canceled, hence the first two event listeners will be pointless.</p>\n<h2 id=\"invocation-of-the-target-object\">Invocation of the target object</h2>\n<p>After the capturing phase ends, the event handlers of the event target object are invocated. Most of the time, as programmer we only care about what happens in this phase. </p>\n<p>One thing to note is that handlers are invoked with the target as their this value, even when registered using addEventListener() .</p>\n<pre><code class=\"language-javascript\">    button.onclick = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) </span>{\n        <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-built_in\">this</span>);\n        <span class=\"hljs-comment\">// this is the button object</span>\n    }\n\n    button.addEventListener(<span class=\"hljs-string\">&quot;click&quot;</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\"></span>) </span>{\n        <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-built_in\">this</span>);\n        <span class=\"hljs-comment\">// same, this is the button object</span>\n    })\n    \n    button.addEventListener(<span class=\"hljs-string\">&quot;click&quot;</span>, <span class=\"hljs-function\">() =&gt;</span> {\n        <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-built_in\">this</span>); \n        <span class=\"hljs-comment\">// alert, this will be the environment where button is defined. typically window object.</span>\n    })\n</code></pre>\n<h2 id=\"bubbling-phase\">Bubbling phase</h2>\n<p>After the event handlers registered on the target element are invoked, most events &quot;bubble&quot; up the DOM tree.</p>\n<pre><code class=\"language-html\">    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;box&quot;</span>&gt;</span>\n        <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">button</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;button&quot;</span>&gt;</span>Button<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">button</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">div</span> <span class=\"hljs-attr\">id</span>=<span class=\"hljs-string\">&quot;other&quot;</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">div</span>&gt;</span>\n    <span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">script</span>&gt;</span><span class=\"javascript\">\n        <span class=\"hljs-keyword\">const</span> button = <span class=\"hljs-built_in\">document</span>.getElementById(<span class=\"hljs-string\">&quot;button&quot;</span>);\n        <span class=\"hljs-keyword\">const</span> box = <span class=\"hljs-built_in\">document</span>.getElementById(<span class=\"hljs-string\">&quot;box&quot;</span>);\n        <span class=\"hljs-keyword\">const</span> other = <span class=\"hljs-built_in\">document</span>.getElementById(<span class=\"hljs-string\">&quot;other&quot;</span>);\n        button.addEventListener(<span class=\"hljs-string\">&quot;click&quot;</span>, <span class=\"hljs-function\">() =&gt;</span> {\n            <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">&quot;hello from button&quot;</span>);\n        })\n        box.addEventListener(<span class=\"hljs-string\">&quot;click&quot;</span>, <span class=\"hljs-function\">() =&gt;</span> {\n            <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">&quot;hello from box&quot;</span>);\n        })\n        other.addEventListener(<span class=\"hljs-string\">&quot;click&quot;</span>, <span class=\"hljs-function\">() =&gt;</span> {\n            <span class=\"hljs-built_in\">console</span>.log(<span class=\"hljs-string\">&quot;i won&#x27;t be called ever&quot;</span>);\n        })\n    </span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">script</span>&gt;</span>\n</code></pre>\n<p>when different dom elements need event handlers, you can utilise this default bubbling behavior, by registering a single handler on a common ancestor element and handle events there. you can use event.target property to check which child element fired the specific event.</p>\n<p>Do note that a few event types don&#39;t follow this bubbling rule, such as &quot;focus&quot;, &quot;blur&quot;, &quot;scroll&quot;.</p>\n<p>An event target may have more than one event handler registered for a particular\ntype of event. When an event of that type occurs, the browser invokes all of the han‚Äê\ndlers in the order in which they were registered.</p>\n","bodyBegin":7,"frontmatter":"title: Three phases of event propagation in javascript\ndate: 2020-11-02T08:50:36.785Z"},"isIndex":true}},"__N_SSG":true}