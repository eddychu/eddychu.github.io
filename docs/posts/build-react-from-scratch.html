<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="assets/_next/static/css/1278ef04f58135567ed5.css" as="style"/><link rel="stylesheet" href="assets/_next/static/css/1278ef04f58135567ed5.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="assets/_next/static/chunks/main-f9fd3cec4cd61a2bf658.js" as="script"/><link rel="preload" href="assets/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="assets/_next/static/chunks/framework.e2fe4ae6b85b1c7a6eb1.js" as="script"/><link rel="preload" href="assets/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.23b275bb1154546a6097.js" as="script"/><link rel="preload" href="assets/_next/static/chunks/pages/_app-e4c171c9eb99bb66b0bc.js" as="script"/><link rel="preload" href="assets/_next/static/chunks/pages/posts/%5B...slug%5D-58a86bf1f6431a15db8f.js" as="script"/></head><body><div id="__next"><div><h2><a href="/">Connecting Dots</a></h2><hr/><h1>Build the worst React from scratch</h1><div><p>I&#39;m building a toy react library to learn more about how it works under the hood. All the code here can be found in this github <a href="https://github.com/eddychu/simple-react">repository</a>.</p>
<h2 id="reactcreateelement">React.createElement</h2>
<pre><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createElement</span> <span class="hljs-params">(type,props, <span class="hljs-rest_arg">...children</span>)</span> </span>{
    <span class="hljs-keyword">return</span> {
        type,
        props: {
            ...props,
            children: children.map(item =&gt; 
                <span class="hljs-keyword">typeof</span> item === <span class="hljs-string">&quot;object&quot;</span> ? item : createTextNode(item)   
            )
        }
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createTextNode</span> <span class="hljs-params">(value)</span> </span>{
    <span class="hljs-keyword">return</span> {
        type: <span class="hljs-string">&quot;TEXT&quot;</span>,
        props: {
            nodeValue: value,
            children: []
        }
    }
}
</code></pre>
<p>when building react apps, we don&#39;t use createElement function itself. Instead we describe UI component by using a language called &quot;JSX&quot;. But under the hood the JSX transpiler would call createElement function, which returns the React element object exactly like the code above.</p>
<h3 id="reactdomrender">ReactDOM.render</h3>
<pre><code><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createDom</span>(<span class="hljs-params">element</span>) =&gt; </span>{
    <span class="hljs-keyword">const</span> {<span class="hljs-keyword">type</span>, props} = element;
    <span class="hljs-keyword">const</span> {children} = props;
    <span class="hljs-keyword">const</span> isDomElement = <span class="hljs-keyword">typeof</span> <span class="hljs-keyword">type</span> === <span class="hljs-string">&quot;string&quot;</span>;
    <span class="hljs-keyword">let</span> dom;
    <span class="hljs-keyword">if</span>(isDomElement) {
        <span class="hljs-keyword">const</span> isTextElement = <span class="hljs-keyword">type</span> === <span class="hljs-string">&quot;TEXT&quot;</span>;
        dom = isTextElement
            ? <span class="hljs-built_in">document</span>.createTextNode(props.nodeValue)
            : <span class="hljs-built_in">document</span>.createElement(<span class="hljs-keyword">type</span>);
        <span class="hljs-built_in">Object</span>.keys(props)
            .filter(isEvent)
            .forEach(<span class="hljs-function"><span class="hljs-params">name</span> =&gt;</span> {
                <span class="hljs-keyword">const</span> eventType = name.toLowerCase().substring(<span class="hljs-number">2</span>);
                dom.addEventListener(eventType, props[name]);
            })
        children.map(<span class="hljs-function"><span class="hljs-params">child</span> =&gt;</span> dom.appendChild(createDom(child)))
        <span class="hljs-keyword">return</span> dom;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">let</span> element = <span class="hljs-keyword">type</span>(props);
        <span class="hljs-keyword">return</span> createDom(element)
    }
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span>(<span class="hljs-params">element, container</span>) =&gt; </span>{
    <span class="hljs-keyword">let</span> dom = createDom(element);
    container.appendChild(dom);
}
</code></pre>
<p>with this render function implemented. we can manage to create a basic static hello world component and render it in the document. (you need babel to transpile jsx syntax, to simplicify stuff. you can use parcel bundler which do the transpilation automatically.)</p>
<pre><code><span class="hljs-keyword">const</span> App = <span class="hljs-function">() =&gt;</span> (<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>Hello World<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>)
</code></pre>
<h3 id="reactusestate">React.useState</h3>
<p>A static webpage with nothing changes wouldn&#39;t be exciting. We need to enable state to make the component dynamic.</p>
<pre><code>    let <span class="hljs-literal">all</span>States = [];
    let currentStateIndex = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">const</span> useState = (initialValue) =&gt; {
        if(currentStateIndex === <span class="hljs-literal">all</span>States.length) {
            <span class="hljs-keyword">const</span> <span class="hljs-keyword">state</span> = {
                value: initialValue,
                <span class="hljs-built_in">set</span>State(newValue) {
                    <span class="hljs-keyword">state</span>.value = newValue;
                    currentStateIndex = <span class="hljs-number">0</span>;
                }
            }
            <span class="hljs-literal">all</span>States.push(<span class="hljs-keyword">state</span>);
        }
        <span class="hljs-keyword">const</span> currentState = <span class="hljs-literal">all</span>States[currentStateIndex];
        currentStateIndex += <span class="hljs-number">1</span>;
        return [currentState.value, currentState.<span class="hljs-built_in">set</span>State]
    }
</code></pre>
<p>Now we are able to create a simple counter component to count how many times have we clicked it.</p>
<pre><code>    <span class="hljs-keyword">const</span> Counter = () =&gt; {
    <span class="hljs-keyword">const</span> [<span class="hljs-keyword">state</span>, <span class="hljs-built_in">set</span>State] = React.useState(<span class="hljs-number">0</span>);
    <span class="hljs-keyword">const</span> handleClick = (e) =&gt; {
        <span class="hljs-built_in">set</span>State(<span class="hljs-keyword">state</span> + <span class="hljs-number">1</span>);
    }
    return <span class="hljs-variable">&lt;h1 onClick={handleClick}&gt;</span>{<span class="hljs-keyword">state</span>}&lt;/h1&gt;
}
</code></pre>
<p>That&#39;s all we need to implement a simplified version of React.</p>
</div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"type":"file","path":"index","content":{"attributes":{"title":"Build the worst React from scratch","date":"Tue Oct 27 2020 11:09:20 GMT+0800 (China Standard Time)","tags":["React"]},"body":"\u003cp\u003eI\u0026#39;m building a toy react library to learn more about how it works under the hood. All the code here can be found in this github \u003ca href=\"https://github.com/eddychu/simple-react\"\u003erepository\u003c/a\u003e.\u003c/p\u003e\n\u003ch2 id=\"reactcreateelement\"\u003eReact.createElement\u003c/h2\u003e\n\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ecreateElement\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(type,props, \u003cspan class=\"hljs-rest_arg\"\u003e...children\u003c/span\u003e)\u003c/span\u003e \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n        type,\n        props: {\n            ...props,\n            children: children.map(item =\u0026gt; \n                \u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e item === \u003cspan class=\"hljs-string\"\u003e\u0026quot;object\u0026quot;\u003c/span\u003e ? item : createTextNode(item)   \n            )\n        }\n    }\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ecreateTextNode\u003c/span\u003e \u003cspan class=\"hljs-params\"\u003e(value)\u003c/span\u003e \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e {\n        type: \u003cspan class=\"hljs-string\"\u003e\u0026quot;TEXT\u0026quot;\u003c/span\u003e,\n        props: {\n            nodeValue: value,\n            children: []\n        }\n    }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ewhen building react apps, we don\u0026#39;t use createElement function itself. Instead we describe UI component by using a language called \u0026quot;JSX\u0026quot;. But under the hood the JSX transpiler would call createElement function, which returns the React element object exactly like the code above.\u003c/p\u003e\n\u003ch3 id=\"reactdomrender\"\u003eReactDOM.render\u003c/h3\u003e\n\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003ecreateDom\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eelement\u003c/span\u003e) =\u0026gt; \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e {\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e, props} = element;\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e {children} = props;\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e isDomElement = \u003cspan class=\"hljs-keyword\"\u003etypeof\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e === \u003cspan class=\"hljs-string\"\u003e\u0026quot;string\u0026quot;\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e dom;\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e(isDomElement) {\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e isTextElement = \u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e === \u003cspan class=\"hljs-string\"\u003e\u0026quot;TEXT\u0026quot;\u003c/span\u003e;\n        dom = isTextElement\n            ? \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.createTextNode(props.nodeValue)\n            : \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.createElement(\u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e);\n        \u003cspan class=\"hljs-built_in\"\u003eObject\u003c/span\u003e.keys(props)\n            .filter(isEvent)\n            .forEach(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003ename\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n                \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e eventType = name.toLowerCase().substring(\u003cspan class=\"hljs-number\"\u003e2\u003c/span\u003e);\n                dom.addEventListener(eventType, props[name]);\n            })\n        children.map(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003echild\u003c/span\u003e =\u0026gt;\u003c/span\u003e dom.appendChild(createDom(child)))\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e dom;\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n        \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e element = \u003cspan class=\"hljs-keyword\"\u003etype\u003c/span\u003e(props);\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e createDom(element)\n    }\n}\n\n\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eelement, container\u003c/span\u003e) =\u0026gt; \u003c/span\u003e{\n    \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e dom = createDom(element);\n    container.appendChild(dom);\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ewith this render function implemented. we can manage to create a basic static hello world component and render it in the document. (you need babel to transpile jsx syntax, to simplicify stuff. you can use parcel bundler which do the transpilation automatically.)\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e App = \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e (\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003eHello World\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e)\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"reactusestate\"\u003eReact.useState\u003c/h3\u003e\n\u003cp\u003eA static webpage with nothing changes wouldn\u0026#39;t be exciting. We need to enable state to make the component dynamic.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e    let \u003cspan class=\"hljs-literal\"\u003eall\u003c/span\u003eStates = [];\n    let currentStateIndex = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e useState = (initialValue) =\u0026gt; {\n        if(currentStateIndex === \u003cspan class=\"hljs-literal\"\u003eall\u003c/span\u003eStates.length) {\n            \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003estate\u003c/span\u003e = {\n                value: initialValue,\n                \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eState(newValue) {\n                    \u003cspan class=\"hljs-keyword\"\u003estate\u003c/span\u003e.value = newValue;\n                    currentStateIndex = \u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e;\n                }\n            }\n            \u003cspan class=\"hljs-literal\"\u003eall\u003c/span\u003eStates.push(\u003cspan class=\"hljs-keyword\"\u003estate\u003c/span\u003e);\n        }\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e currentState = \u003cspan class=\"hljs-literal\"\u003eall\u003c/span\u003eStates[currentStateIndex];\n        currentStateIndex += \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e;\n        return [currentState.value, currentState.\u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eState]\n    }\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eNow we are able to create a simple counter component to count how many times have we clicked it.\u003c/p\u003e\n\u003cpre\u003e\u003ccode\u003e    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e Counter = () =\u0026gt; {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [\u003cspan class=\"hljs-keyword\"\u003estate\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eState] = React.useState(\u003cspan class=\"hljs-number\"\u003e0\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e handleClick = (e) =\u0026gt; {\n        \u003cspan class=\"hljs-built_in\"\u003eset\u003c/span\u003eState(\u003cspan class=\"hljs-keyword\"\u003estate\u003c/span\u003e + \u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e);\n    }\n    return \u003cspan class=\"hljs-variable\"\u003e\u0026lt;h1 onClick={handleClick}\u0026gt;\u003c/span\u003e{\u003cspan class=\"hljs-keyword\"\u003estate\u003c/span\u003e}\u0026lt;/h1\u0026gt;\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eThat\u0026#39;s all we need to implement a simplified version of React.\u003c/p\u003e\n","bodyBegin":8,"frontmatter":"title: Build the worst React from scratch\ndate: 2020-10-27T03:09:20.631Z\ntags:\n    - React"},"isIndex":true}},"__N_SSG":true},"page":"/posts/[...slug]","query":{"slug":["build-react-from-scratch"]},"buildId":"5jdDaeqHq26ewQDr1S2Zn","assetPrefix":"assets","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="assets/_next/static/chunks/polyfills-4f14e8c8ea1352d3ef0d.js"></script><script src="assets/_next/static/chunks/main-f9fd3cec4cd61a2bf658.js" async=""></script><script src="assets/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="assets/_next/static/chunks/framework.e2fe4ae6b85b1c7a6eb1.js" async=""></script><script src="assets/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.23b275bb1154546a6097.js" async=""></script><script src="assets/_next/static/chunks/pages/_app-e4c171c9eb99bb66b0bc.js" async=""></script><script src="assets/_next/static/chunks/pages/posts/%5B...slug%5D-58a86bf1f6431a15db8f.js" async=""></script><script src="assets/_next/static/5jdDaeqHq26ewQDr1S2Zn/_buildManifest.js" async=""></script><script src="assets/_next/static/5jdDaeqHq26ewQDr1S2Zn/_ssgManifest.js" async=""></script></body></html>