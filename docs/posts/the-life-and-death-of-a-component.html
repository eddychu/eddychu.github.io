<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/1278ef04f58135567ed5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1278ef04f58135567ed5.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-f9fd3cec4cd61a2bf658.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.e2fe4ae6b85b1c7a6eb1.js" as="script"/><link rel="preload" href="/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.23b275bb1154546a6097.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-e4c171c9eb99bb66b0bc.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5B...slug%5D-58a86bf1f6431a15db8f.js" as="script"/></head><body><div id="__next"><div><h2><a href="/">Connecting Dots</a></h2><hr/><h1>The life and death of a React Class Component</h1><div><p>If you were confused by React (Class) Component&#39;s life cycle methods, I hope this article will help you understand it better.</p>
<p>There are three phases in the whole lifecyle of a react component, namely mounting, updating and unmounting. In a class component, during each phase there are a few functions will be called by React runtime one by one.</p>
<p>try it on <a href="https://codesandbox.io/s/component-lifecycle-j0jtn">codesandbox</a></p>
<h2 id="mounting--the-birth-of-a-react-component">Mounting : The birth of a React component</h2>
<pre><code class="language-javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Message</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
  <span class="hljs-function"><span class="hljs-title">constructor</span>(<span class="hljs-params">props</span>)</span> {
    <span class="hljs-built_in">super</span>(props);
    <span class="hljs-built_in">this</span>.state = { <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;hello world&quot;</span> };
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;1: Message Constructor&quot;</span>);
  }

  <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-title">getDerivedStateFromProps</span>(<span class="hljs-params">props, state</span>)</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;2: getDerivedStateFromProps&quot;</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
  }

  <span class="hljs-function"><span class="hljs-title">render</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;3: render&quot;</span>);
    <span class="hljs-keyword">return</span> <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;message&quot;</span>&gt;</span>{this.state.message}<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>;
  }

  <span class="hljs-function"><span class="hljs-title">componentDidMount</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;4: componentDidMount&quot;</span>);
    <span class="hljs-comment">// console.log(document.getElementById(&quot;message&quot;))</span>
  }
}
</code></pre>
<p>when react start to render our Message component, the constructor is the first method to be called. Then a static function getDerivedStateFromProps is called to give us a chance to change the state based on initial props. after the render function, the dom element is finally added to the dom, then react calls componentDidMount() function, after this step the dom element is finally accessible.</p>
<h2 id="updating-a-change-of-state">Updating: A change of state</h2>
<pre><code class="language-javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Message</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
  <span class="hljs-comment">// ...</span>
  <span class="hljs-function"><span class="hljs-title">handleClick</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-built_in">this</span>.setState({ <span class="hljs-attr">message</span>: <span class="hljs-string">&quot;goodbye!&quot;</span> });
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;state changed, we need update now !!!!&quot;</span>);
  }

  <span class="hljs-function"><span class="hljs-title">shouldComponentUpdate</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;4: shouldComponentUpdate&quot;</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
  }

  <span class="hljs-function"><span class="hljs-title">render</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;5: render&quot;</span>);
    <span class="hljs-keyword">return</span> (
      <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{this.handleClick}</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;message&quot;</span>&gt;</span>
        {this.state.message}
      <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
    );
  }

  <span class="hljs-function"><span class="hljs-title">componentDidUpdate</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;6: componentDidUpdate&quot;</span>);
  }
}
</code></pre>
<p>After we click the component, handleClick function changes the message state. shouldComponentUpdate is called the next step. If this function returns false, nothing would be updated. If it returns true, render function will be called with the updated state.</p>
<h2 id="unmounting-time-to-say-goodbye">Unmounting: Time to say goodbye</h2>
<pre><code class="language-javascript"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Message</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Component</span> </span>{
  <span class="hljs-function"><span class="hljs-title">componentWillUnmount</span>(<span class="hljs-params"></span>)</span> {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;7: unmount&quot;</span>);
  }
}

<span class="hljs-keyword">const</span> App = <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-keyword">const</span> [show, setShow] = useState(<span class="hljs-literal">false</span>);

  <span class="hljs-keyword">return</span> (
    <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>
      {show &amp;&amp; <span class="hljs-tag">&lt;<span class="hljs-name">Message</span> /&gt;</span>}
      <span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onClick</span>=<span class="hljs-string">{()</span> =&gt;</span> setShow((show) =&gt; !show)}&gt;toggle Message<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></span>
  );
};

render(<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">App</span> /&gt;</span></span>, <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;root&quot;</span>));
</code></pre>
<p>when show is toggled off, the last life cycle method componentWillUnmount will be called. <Message /> component then will be removed from the DOM tree.</p>
</div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"type":"file","path":"index","content":{"attributes":{"title":"The life and death of a React Class Component","date":"Thu Oct 29 2020 13:58:11 GMT+0800 (China Standard Time)"},"body":"\u003cp\u003eIf you were confused by React (Class) Component\u0026#39;s life cycle methods, I hope this article will help you understand it better.\u003c/p\u003e\n\u003cp\u003eThere are three phases in the whole lifecyle of a react component, namely mounting, updating and unmounting. In a class component, during each phase there are a few functions will be called by React runtime one by one.\u003c/p\u003e\n\u003cp\u003etry it on \u003ca href=\"https://codesandbox.io/s/component-lifecycle-j0jtn\"\u003ecodesandbox\u003c/a\u003e\u003c/p\u003e\n\u003ch2 id=\"mounting--the-birth-of-a-react-component\"\u003eMounting : The birth of a React component\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eMessage\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eComponent\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003econstructor\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eprops\u003c/span\u003e)\u003c/span\u003e {\n    \u003cspan class=\"hljs-built_in\"\u003esuper\u003c/span\u003e(props);\n    \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e.state = { \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;hello world\u0026quot;\u003c/span\u003e };\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\u0026quot;1: Message Constructor\u0026quot;\u003c/span\u003e);\n  }\n\n  \u003cspan class=\"hljs-keyword\"\u003estatic\u003c/span\u003e \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003egetDerivedStateFromProps\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eprops, state\u003c/span\u003e)\u003c/span\u003e {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\u0026quot;2: getDerivedStateFromProps\u0026quot;\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003enull\u003c/span\u003e;\n  }\n\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\u0026quot;3: render\u0026quot;\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;message\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e{this.state.message}\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e;\n  }\n\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ecomponentDidMount\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\u0026quot;4: componentDidMount\u0026quot;\u003c/span\u003e);\n    \u003cspan class=\"hljs-comment\"\u003e// console.log(document.getElementById(\u0026quot;message\u0026quot;))\u003c/span\u003e\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ewhen react start to render our Message component, the constructor is the first method to be called. Then a static function getDerivedStateFromProps is called to give us a chance to change the state based on initial props. after the render function, the dom element is finally added to the dom, then react calls componentDidMount() function, after this step the dom element is finally accessible.\u003c/p\u003e\n\u003ch2 id=\"updating-a-change-of-state\"\u003eUpdating: A change of state\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eMessage\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eComponent\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-comment\"\u003e// ...\u003c/span\u003e\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ehandleClick\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e {\n    \u003cspan class=\"hljs-built_in\"\u003ethis\u003c/span\u003e.setState({ \u003cspan class=\"hljs-attr\"\u003emessage\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026quot;goodbye!\u0026quot;\u003c/span\u003e });\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\u0026quot;state changed, we need update now !!!!\u0026quot;\u003c/span\u003e);\n  }\n\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003eshouldComponentUpdate\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\u0026quot;4: shouldComponentUpdate\u0026quot;\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n  }\n\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003erender\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\u0026quot;5: render\u0026quot;\u003c/span\u003e);\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n      \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eonClick\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{this.handleClick}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;message\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\n        {this.state.message}\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n    );\n  }\n\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ecomponentDidUpdate\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\u0026quot;6: componentDidUpdate\u0026quot;\u003c/span\u003e);\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eAfter we click the component, handleClick function changes the message state. shouldComponentUpdate is called the next step. If this function returns false, nothing would be updated. If it returns true, render function will be called with the updated state.\u003c/p\u003e\n\u003ch2 id=\"unmounting-time-to-say-goodbye\"\u003eUnmounting: Time to say goodbye\u003c/h2\u003e\n\u003cpre\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"hljs-class\"\u003e\u003cspan class=\"hljs-keyword\"\u003eclass\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eMessage\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003eextends\u003c/span\u003e \u003cspan class=\"hljs-title\"\u003eComponent\u003c/span\u003e \u003c/span\u003e{\n  \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-title\"\u003ecomponentWillUnmount\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e)\u003c/span\u003e {\n    \u003cspan class=\"hljs-built_in\"\u003econsole\u003c/span\u003e.log(\u003cspan class=\"hljs-string\"\u003e\u0026quot;7: unmount\u0026quot;\u003c/span\u003e);\n  }\n}\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e App = \u003cspan class=\"hljs-function\"\u003e() =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e [show, setShow] = useState(\u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e (\n    \u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n      {show \u0026amp;\u0026amp; \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eMessage\u003c/span\u003e /\u0026gt;\u003c/span\u003e}\n      \u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eonClick\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{()\u003c/span\u003e =\u0026gt;\u003c/span\u003e setShow((show) =\u0026gt; !show)}\u0026gt;toggle Message\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebutton\u003c/span\u003e\u0026gt;\u003c/span\u003e\n    \u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003c/span\u003e\n  );\n};\n\nrender(\u003cspan class=\"xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eApp\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e, \u003cspan class=\"hljs-built_in\"\u003edocument\u003c/span\u003e.getElementById(\u003cspan class=\"hljs-string\"\u003e\u0026quot;root\u0026quot;\u003c/span\u003e));\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003ewhen show is toggled off, the last life cycle method componentWillUnmount will be called. \u003cMessage /\u003e component then will be removed from the DOM tree.\u003c/p\u003e\n","bodyBegin":6,"frontmatter":"title: The life and death of a React Class Component\ndate: 2020-10-29T05:58:11.637Z"},"isIndex":true}},"__N_SSG":true},"page":"/posts/[...slug]","query":{"slug":["the-life-and-death-of-a-component"]},"buildId":"XWzjT4iE0jZx_wc0KS8C2","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-4f14e8c8ea1352d3ef0d.js"></script><script src="/_next/static/chunks/main-f9fd3cec4cd61a2bf658.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.e2fe4ae6b85b1c7a6eb1.js" async=""></script><script src="/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.23b275bb1154546a6097.js" async=""></script><script src="/_next/static/chunks/pages/_app-e4c171c9eb99bb66b0bc.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5B...slug%5D-58a86bf1f6431a15db8f.js" async=""></script><script src="/_next/static/XWzjT4iE0jZx_wc0KS8C2/_buildManifest.js" async=""></script><script src="/_next/static/XWzjT4iE0jZx_wc0KS8C2/_ssgManifest.js" async=""></script></body></html>