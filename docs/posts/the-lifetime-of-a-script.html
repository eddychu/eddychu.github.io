<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/1278ef04f58135567ed5.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1278ef04f58135567ed5.css" data-n-g=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-f9fd3cec4cd61a2bf658.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.e2fe4ae6b85b1c7a6eb1.js" as="script"/><link rel="preload" href="/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.23b275bb1154546a6097.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-e4c171c9eb99bb66b0bc.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/posts/%5B...slug%5D-58a86bf1f6431a15db8f.js" as="script"/></head><body><div id="__next"><div><h2><a href="/">Connecting Dots</a></h2><hr/><h1>The lifetime of a script</h1><div><p>When web browser loads a webpage, a document is created, parsed, until it is fully loaded. During these phases, the javascript programs are first synchrounously loaded and excuted and then transit into an event-handling asynchrounous execution. </p>
<h2 id="step-1-loading-the-document">Step 1: Loading the document</h2>
<p>Before the web browser starts parsing a web page, it will first creates a document object. <em><strong>the browser set document.readyState property to be loading</strong></em>. As the parser scan through the webpage, dom element objects will be added to the document object in the order that the parser encounters them. </p>
<p>When the HTML parser encounters a &lt;script&gt; tag. There are a few scenarios might happen during this phase:</p>
<h3 id="1-inline-script">1. inline script</h3>
<p>If it is an inline &lt;script&gt; tag or &lt;script\ src=&quot;&quot;&gt; tag without async, defer, or type=&quot;module&quot; attributes, the script element will be added to document just like any other dom elements. It will also be exectued synchronously in the same order the parser encounters them. The script will have access to its own &lt;script&gt; tag and document content that comes before itself. Before the script is fully loaded and excuted, the Html parser cannot proceed the dom construction. Because the script can call document.write() function which would totally change the whole document structure, which renders the dom parser work totally pointless.</p>
<h3 id="2-async-script">2. async script</h3>
<p>When the parser encounters a &lt;script&gt; that has async attribute set, it begin downloading the script text and continues parsing the rest of document. After the script content is downloaded, it will be executed. Once it is downloaded they behave pretty much the same as inline &lt;script&gt; tag.</p>
<p><em>Do note that it is highly possible that the parser might already parsed the whole document by the time the async script is downloaded (might happen in step 2 or even step 3), in which case, the (async) script will have the whole access to the whole document object.</em></p>
<h3 id="3-module-script">3. module script</h3>
<p>a module script is a script with type=&quot;module&quot; attribute set. It behaves the same as async script, with one difference that when the browser begins downloading the script, it will also download all of the script’s dependencies. while the parser continues to parsing the document.</p>
<h2 id="step-2-document-is-parsed">Step 2: document is parsed</h2>
<p>When the document is completely parsed, <em><strong>the document.readyState property
changes to “interactive.”</strong></em></p>
<p>At this phase, any script with defer attribute set (along with any module scripts that do not have an async attribute) are executed in the order in which they appeared in the document.Deferred scripts have access to the complete document.</p>
<h2 id="step-3-document-is-ready">Step 3: document is ready</h2>
<p>The browser fires a “DOMContentLoaded” event on the Document object. <em><strong>This
marks the transition from synchronous script-execution phase to the
asynchronous, event-driven phase of program execution</strong></em>. Only async script might still haven&#39;t be exectued at this phase (might because of slow internet speed or script file too large so it takes too long to download)</p>
<p>The browser may still be waiting for additional content, such as images, to load. When all such content finishes loading, and when all async scripts have loaded and executed, <em><strong>the document.readyState property changes to “complete” and the web browser fires
a “load” event on the Window object</strong></em>.</p>
<p>From this point on, event handlers are invoked asynchronously in response to
user input events, network events, timer expirations, and so on.</p>
<blockquote>
<p>Reference: Javascript: The Definitive Guide, 7th Edition</p>
</blockquote>
</div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"type":"file","path":"index","content":{"attributes":{"title":"The lifetime of a script","date":"Sat Oct 31 2020 21:21:31 GMT+0800 (China Standard Time)"},"body":"\u003cp\u003eWhen web browser loads a webpage, a document is created, parsed, until it is fully loaded. During these phases, the javascript programs are first synchrounously loaded and excuted and then transit into an event-handling asynchrounous execution. \u003c/p\u003e\n\u003ch2 id=\"step-1-loading-the-document\"\u003eStep 1: Loading the document\u003c/h2\u003e\n\u003cp\u003eBefore the web browser starts parsing a web page, it will first creates a document object. \u003cem\u003e\u003cstrong\u003ethe browser set document.readyState property to be loading\u003c/strong\u003e\u003c/em\u003e. As the parser scan through the webpage, dom element objects will be added to the document object in the order that the parser encounters them. \u003c/p\u003e\n\u003cp\u003eWhen the HTML parser encounters a \u0026lt;script\u0026gt; tag. There are a few scenarios might happen during this phase:\u003c/p\u003e\n\u003ch3 id=\"1-inline-script\"\u003e1. inline script\u003c/h3\u003e\n\u003cp\u003eIf it is an inline \u0026lt;script\u0026gt; tag or \u0026lt;script\\ src=\u0026quot;\u0026quot;\u0026gt; tag without async, defer, or type=\u0026quot;module\u0026quot; attributes, the script element will be added to document just like any other dom elements. It will also be exectued synchronously in the same order the parser encounters them. The script will have access to its own \u0026lt;script\u0026gt; tag and document content that comes before itself. Before the script is fully loaded and excuted, the Html parser cannot proceed the dom construction. Because the script can call document.write() function which would totally change the whole document structure, which renders the dom parser work totally pointless.\u003c/p\u003e\n\u003ch3 id=\"2-async-script\"\u003e2. async script\u003c/h3\u003e\n\u003cp\u003eWhen the parser encounters a \u0026lt;script\u0026gt; that has async attribute set, it begin downloading the script text and continues parsing the rest of document. After the script content is downloaded, it will be executed. Once it is downloaded they behave pretty much the same as inline \u0026lt;script\u0026gt; tag.\u003c/p\u003e\n\u003cp\u003e\u003cem\u003eDo note that it is highly possible that the parser might already parsed the whole document by the time the async script is downloaded (might happen in step 2 or even step 3), in which case, the (async) script will have the whole access to the whole document object.\u003c/em\u003e\u003c/p\u003e\n\u003ch3 id=\"3-module-script\"\u003e3. module script\u003c/h3\u003e\n\u003cp\u003ea module script is a script with type=\u0026quot;module\u0026quot; attribute set. It behaves the same as async script, with one difference that when the browser begins downloading the script, it will also download all of the script’s dependencies. while the parser continues to parsing the document.\u003c/p\u003e\n\u003ch2 id=\"step-2-document-is-parsed\"\u003eStep 2: document is parsed\u003c/h2\u003e\n\u003cp\u003eWhen the document is completely parsed, \u003cem\u003e\u003cstrong\u003ethe document.readyState property\nchanges to “interactive.”\u003c/strong\u003e\u003c/em\u003e\u003c/p\u003e\n\u003cp\u003eAt this phase, any script with defer attribute set (along with any module scripts that do not have an async attribute) are executed in the order in which they appeared in the document.Deferred scripts have access to the complete document.\u003c/p\u003e\n\u003ch2 id=\"step-3-document-is-ready\"\u003eStep 3: document is ready\u003c/h2\u003e\n\u003cp\u003eThe browser fires a “DOMContentLoaded” event on the Document object. \u003cem\u003e\u003cstrong\u003eThis\nmarks the transition from synchronous script-execution phase to the\nasynchronous, event-driven phase of program execution\u003c/strong\u003e\u003c/em\u003e. Only async script might still haven\u0026#39;t be exectued at this phase (might because of slow internet speed or script file too large so it takes too long to download)\u003c/p\u003e\n\u003cp\u003eThe browser may still be waiting for additional content, such as images, to load. When all such content finishes loading, and when all async scripts have loaded and executed, \u003cem\u003e\u003cstrong\u003ethe document.readyState property changes to “complete” and the web browser fires\na “load” event on the Window object\u003c/strong\u003e\u003c/em\u003e.\u003c/p\u003e\n\u003cp\u003eFrom this point on, event handlers are invoked asynchronously in response to\nuser input events, network events, timer expirations, and so on.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eReference: Javascript: The Definitive Guide, 7th Edition\u003c/p\u003e\n\u003c/blockquote\u003e\n","bodyBegin":6,"frontmatter":"title: The lifetime of a script\ndate: 2020-10-31T13:21:31.324Z"},"isIndex":true}},"__N_SSG":true},"page":"/posts/[...slug]","query":{"slug":["the-lifetime-of-a-script"]},"buildId":"XWzjT4iE0jZx_wc0KS8C2","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-4f14e8c8ea1352d3ef0d.js"></script><script src="/_next/static/chunks/main-f9fd3cec4cd61a2bf658.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.e2fe4ae6b85b1c7a6eb1.js" async=""></script><script src="/_next/static/chunks/f6078781a05fe1bcb0902d23dbbb2662c8d200b3.23b275bb1154546a6097.js" async=""></script><script src="/_next/static/chunks/pages/_app-e4c171c9eb99bb66b0bc.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5B...slug%5D-58a86bf1f6431a15db8f.js" async=""></script><script src="/_next/static/XWzjT4iE0jZx_wc0KS8C2/_buildManifest.js" async=""></script><script src="/_next/static/XWzjT4iE0jZx_wc0KS8C2/_ssgManifest.js" async=""></script></body></html>