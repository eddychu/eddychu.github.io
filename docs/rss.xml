<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Connecting Dots]]></title><description><![CDATA[A personal blog by Eddy Chu]]></description><link>https://gatsby-starter-blog-demo.netlify.app</link><generator>GatsbyJS</generator><lastBuildDate>Tue, 27 Oct 2020 09:23:36 GMT</lastBuildDate><item><title><![CDATA[Build the worst React from scratch]]></title><description><![CDATA[I’m building a toy react library to learn more about how it works under the hood. All the code here can be found in this github repository…]]></description><link>https://gatsby-starter-blog-demo.netlify.app/build-react-from-scratch/</link><guid isPermaLink="false">https://gatsby-starter-blog-demo.netlify.app/build-react-from-scratch/</guid><pubDate>Tue, 27 Oct 2020 03:09:20 GMT</pubDate><content:encoded>&lt;p&gt;I’m building a toy react library to learn more about how it works under the hood. All the code here can be found in this github &lt;a href=&quot;https://github.com/eddychu/simple-react&quot;&gt;repository&lt;/a&gt;.&lt;/p&gt;
&lt;h2&gt;React.createElement&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;function createElement (type,props, ...children) {
    return {
        type,
        props: {
            ...props,
            children: children.map(item =&amp;gt; 
                typeof item === &amp;quot;object&amp;quot; ? item : createTextNode(item)   
            )
        }
    }
}

function createTextNode (value) {
    return {
        type: &amp;quot;TEXT&amp;quot;,
        props: {
            nodeValue: value,
            children: []
        }
    }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;when building react apps, we don’t use createElement function itself. Instead we describe UI component by using a language called “JSX”. But under the hood the JSX transpiler would call createElement function, which returns the React element object exactly like the code above.&lt;/p&gt;
&lt;h3&gt;ReactDOM.render&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;function createDom(element) =&amp;gt; {
    const {type, props} = element;
    const {children} = props;
    const isDomElement = typeof type === &amp;quot;string&amp;quot;;
    let dom;
    if(isDomElement) {
        const isTextElement = type === &amp;quot;TEXT&amp;quot;;
        dom = isTextElement
            ? document.createTextNode(props.nodeValue)
            : document.createElement(type);
        Object.keys(props)
            .filter(isEvent)
            .forEach(name =&amp;gt; {
                const eventType = name.toLowerCase().substring(2);
                dom.addEventListener(eventType, props[name]);
            })
        children.map(child =&amp;gt; dom.appendChild(createDom(child)))
        return dom;
    } else {
        let element = type(props);
        return createDom(element)
    }
}

function render(element, container) =&amp;gt; {
    let dom = createDom(element);
    container.appendChild(dom);
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;with this render function implemented. we can manage to create a basic static hello world component and render it in the document. (you need babel to transpile jsx syntax, to simplicify stuff. you can use parcel bundler which do the transpilation automatically.)&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;const App = () =&amp;gt; (&amp;lt;div&amp;gt;Hello World&amp;lt;/div&amp;gt;)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3&gt;React.useState&lt;/h3&gt;
&lt;p&gt;A static webpage with nothing changes wouldn’t be exciting. We need to enable state to make the component dynamic.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;    let allStates = [];
    let currentStateIndex = 0;
    const useState = (initialValue) =&amp;gt; {
        if(currentStateIndex === allStates.length) {
            const state = {
                value: initialValue,
                setState(newValue) {
                    state.value = newValue;
                    currentStateIndex = 0;
                }
            }
            allStates.push(state);
        }
        const currentState = allStates[currentStateIndex];
        currentStateIndex += 1;
        return [currentState.value, currentState.setState]
    }&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Now we are able to create a simple counter component to count how many times have we clicked it.&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;    const Counter = () =&amp;gt; {
    const [state, setState] = React.useState(0);
    const handleClick = (e) =&amp;gt; {
        setState(state + 1);
    }
    return &amp;lt;h1 onClick={handleClick}&amp;gt;{state}&amp;lt;/h1&amp;gt;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;That’s all we need to implement a simplified version of React.&lt;/p&gt;</content:encoded></item></channel></rss>